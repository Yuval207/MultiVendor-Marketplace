import{u as k}from"./chunk-W3ZDEGX2-HRIi1dAF.js";import{D as A}from"./chunk-VMASTMKW-Ce-vIJ7v.js";import{a4 as G,as as E,a6 as f,ai as _,R as H,av as U,j as r,b as V,ab as Z,ac as q,g as J,r as v,i as Q,l as W,t as S,B as P}from"./index-DEFeRDIL.js";import{d as X,c as Y}from"./chunk-HMR2DA3X-Sh8HVWkm.js";import{c as b}from"./chunk-6GU6IDUA-CDc7wW5L.js";import{K as rr}from"./chunk-6HTZNHPT-HMeIdg7c.js";import{R as u,u as R}from"./chunk-BFJYVY5L-uaLHImxC.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./index.esm-Bh06v7m5.js";import"./index-Cf2cYblr.js";import"./checkbox-Bb3g0FAy.js";import"./prompt-DO1sEl7G.js";var er=e=>{const o={};return e.forEach(s=>{s.price_rules.length||(o[s.currency_code]=s.amount)}),o},sr=e=>{const o={};return e.forEach(s=>{if(s.price_rules.length){const n=s.price_rules[0].value;o[n]=s.amount}}),o},ir=G({region_prices:E(f(),f().or(_()).optional()),currency_prices:E(f(),f().or(_()).optional())});function or({shippingOption:e}){const{t:o}=V(),{handleSuccess:s}=R(),n=Z({defaultValues:{region_prices:sr(e.prices),currency_prices:er(e.prices)},resolver:q(ir)}),{mutateAsync:g,isPending:w}=Y(e.id),{store:d,isLoading:C,isError:L,error:O}=J(),p=v.useMemo(()=>{var t;return((t=d==null?void 0:d.supported_currencies)==null?void 0:t.map(h=>h.currency_code))||[]},[d]),{regions:c,isLoading:F,isError:N,error:T}=Q({fields:"id,name,currency_code",limit:999}),{price_preferences:I}=W({}),{setCloseOnEscape:M}=R(),z=k({name:e.name,currencies:p,regions:c,pricePreferences:I}),B=v.useMemo(()=>[[...p||[],...c||[]]],[p,c]),j=n.handleSubmit(async t=>{const h=Object.entries(t.currency_prices).map(([i,a])=>{if(a===""||a===void 0||!p.some(m=>m.toLowerCase()==i.toLowerCase()))return;const x=b(a),y={currency_code:i,amount:x},l=e.prices.find(m=>m.currency_code===i&&!m.price_rules.length);return l&&(y.id=l.id),y}).filter(i=>!!i),K=Object.entries(t.region_prices).map(([i,a])=>{if(a===""||a===void 0||!(c==null?void 0:c.some(l=>l.id===i)))return;const x=b(a);return{region_id:i,amount:x}}).filter(i=>!!i);await g({prices:[...h,...K]},{onSuccess:()=>{S.success(o("general.success")),s()},onError:i=>{S.error(i.message)}})}),D=C||F||!p||!c;if(L)throw O;if(N)throw T;return r.jsx(u.Form,{form:n,children:r.jsxs(rr,{className:"flex h-full flex-col overflow-hidden",onSubmit:j,children:[r.jsx(u.Header,{}),r.jsx(u.Body,{children:r.jsx("div",{className:"flex size-full flex-col divide-y overflow-hidden",children:r.jsx(A,{isLoading:D,data:B,columns:z,state:n,onEditingChange:t=>M(!t)})})}),r.jsx(u.Footer,{children:r.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[r.jsx(u.Close,{asChild:!0,children:r.jsx(P,{variant:"secondary",size:"small",children:o("actions.cancel")})}),r.jsx(P,{size:"small",className:"whitespace-nowrap",isLoading:w,onClick:j,type:"button",children:o("actions.save")})]})})]})})}function xr(){const{so_id:e,location_id:o}=H();if(!e)throw U({message:"Shipping Option ID paramater is missing",status:404});const{shipping_option:s,isError:n,error:g}=X(e,{fields:"*prices,*prices.price_rules"});if(n)throw g;return r.jsx(u,{prev:`/settings/locations/${o}`,children:s&&r.jsx(or,{shippingOption:s})})}export{xr as Component};
