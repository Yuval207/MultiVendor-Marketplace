import{u as q,a as M,b as B}from"./chunk-QIWEFQ5Y-DZJi28Bq.js";import{u as Q,a as H,b as $}from"./chunk-NLR7MGM2-BB1YICzM.js";import{R as K,d as U,dU as X,a as J,j as e,dF as W,q as E,b as S,u as Y,dV as Z,H as w,A as R,T as u,r as T,dM as V,k as G,dW as ee,bx as i,L as se,B as te,aL as re,p as ae,s as oe,t as f,dX as ie}from"./index-DEFeRDIL.js";import{S as ne}from"./chunk-2RQLKDBF-fPF6GiYf.js";import{u as N,D as z}from"./chunk-OXHHPLX5-BeQnQJj9.js";import"./lodash-CjjdLKfL.js";import"./chunk-BV7MMCXV-CBSjyFz6.js";import"./chunk-QLHWURNJ-C3P-o5j4.js";import{P as I}from"./pencil-square-Tj9O38EM.js";import{T as L}from"./trash-s8WO4VTP.js";import{u as k}from"./use-prompt-6wuxDf0h.js";import{C as _}from"./container-DxC93x08.js";import{S as ce}from"./status-badge-CN5393nQ.js";import{C as A}from"./checkbox-Bb3g0FAy.js";import{c as le}from"./index-Cf2cYblr.js";import"./chunk-C76H5USB-Cet_DDGf.js";import"./chunk-OI7BBNYW-ChZbpW68.js";import"./chunk-P3UUX2T6-BeXLR_Qd.js";import"./chunk-B4FQDBC3-sz7BXTXy.js";import"./format-DxnECnkT.js";import"./chunk-LHJ6JQGA-BR_bLYQx.js";import"./chunk-FSMQADBD-DQ6u7KYm.js";import"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-XFSJ7YIN-CYgS8ok5.js";import"./chunk-ADOCJB6L-CL5SfXv2.js";import"./react-country-flag.esm-BBPeG9DP.js";import"./Trans-CZb6R4yh.js";import"./x-mark-mini-tIH3HTi4.js";import"./chunk-YEDAFXMB-itNofjPe.js";import"./chunk-AOFGTNG6-BapIOu2m.js";import"./chunk-WX2SMNCD-CQjaP0hQ.js";import"./plus-mini-9ktDp-rf.js";import"./command-bar-DfNauWbl.js";import"./index-D6BS3cXt.js";import"./chunk-X4PARRTU-BuL0dl-Z.js";import"./date-picker-DQot2JSl.js";import"./popover-qvxgJjPJ.js";import"./triangle-left-mini-BxJvX9lk.js";import"./prompt-DO1sEl7G.js";var de=({customer:s})=>{const{t}=S(),r=k(),a=Y(),{mutateAsync:l}=Z(s.id),c=[s.first_name,s.last_name].filter(Boolean).join(" "),o=s.has_account?"green":"orange",d=s.has_account?t("customers.fields.registered"):t("customers.fields.guest"),p=async()=>{await r({title:t("customers.delete.title"),description:t("customers.delete.description",{email:s.email}),verificationInstruction:t("general.typeToConfirm"),verificationText:s.email,confirmText:t("actions.delete"),cancelText:t("actions.cancel")})&&await l(void 0,{onSuccess:()=>{f.success(t("customers.delete.successToast",{email:s.email})),a("/customers",{replace:!0})},onError:x=>{f.error(x.message)}})};return e.jsxs(_,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(w,{children:s.email}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(ce,{color:o,children:d}),e.jsx(R,{groups:[{actions:[{label:t("actions.edit"),icon:e.jsx(I,{}),to:"edit"}]},{actions:[{label:t("actions.delete"),icon:e.jsx(L,{}),onClick:p}]}]})]})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.name")}),e.jsx(u,{size:"small",leading:"compact",children:c||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.company")}),e.jsx(u,{size:"small",leading:"compact",children:s.company_name||"-"})]}),e.jsxs("div",{className:"text-ui-fg-subtle grid grid-cols-2 items-center px-6 py-4",children:[e.jsx(u,{size:"small",leading:"compact",weight:"plus",children:t("fields.phone")}),e.jsx(u,{size:"small",leading:"compact",children:s.phone||"-"})]})]})},v=10,j="cusgr",me=({customer:s})=>{const t=k(),[r,a]=T.useState({}),{raw:l,searchParams:c}=q({pageSize:v,prefix:j}),{customer_groups:o,count:d,isLoading:p,isError:g,error:x}=V({...c,fields:"+customers.id",customers:{id:s.id}},{placeholderData:G}),{mutateAsync:h}=ee(s.id),y=M(),P=pe(s.id),{table:O}=N({data:o??[],columns:P,count:d,getRowId:m=>m.id,enablePagination:!0,enableRowSelection:!0,pageSize:v,prefix:j,rowSelection:{state:r,updater:a}}),F=async()=>{const m=Object.keys(r);if(await t({title:i("general.areYouSure"),description:i("customers.groups.removeMany",{groups:o==null?void 0:o.filter(n=>m.includes(n.id)).map(n=>n.name).join(",")}),confirmText:i("actions.remove"),cancelText:i("actions.cancel")}))try{await h({remove:m}),f.success(i("customers.groups.removed.success",{groups:o.filter(n=>m.includes(n.id)).map(n=>n==null?void 0:n.name)}))}catch(n){f.error(n.message)}};if(g)throw x;return e.jsxs(_,{className:"divide-y p-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4",children:[e.jsx(w,{level:"h2",children:i("customerGroups.domain")}),e.jsx(se,{to:`/customers/${s.id}/add-customer-groups`,children:e.jsx(te,{variant:"secondary",size:"small",children:i("general.add")})})]}),e.jsx(z,{table:O,columns:P,pageSize:v,isLoading:p,count:d,prefix:j,navigateTo:m=>`/customer-groups/${m.id}`,filters:y,search:!0,pagination:!0,orderBy:[{key:"name",label:i("fields.name")},{key:"created_at",label:i("fields.createdAt")},{key:"updated_at",label:i("fields.updatedAt")}],commands:[{action:F,label:i("actions.remove"),shortcut:"r"}],queryObject:l,noRecords:{message:i("customers.groups.list.noRecordsMessage")}})]})},ue=({group:s,customerId:t})=>{const r=k(),{t:a}=S(),{mutateAsync:l}=ie(s.id),c=async()=>{await r({title:a("general.areYouSure"),description:a("customers.groups.remove",{name:s.name}),confirmText:a("actions.remove"),cancelText:a("actions.cancel")})&&await l([t],{onError:d=>{f.error(d.message)}})};return e.jsx(R,{groups:[{actions:[{label:a("actions.edit"),icon:e.jsx(I,{}),to:`/customer-groups/${s.id}/edit`},{label:a("actions.remove"),onClick:c,icon:e.jsx(L,{})}]}]})},D=le(),pe=s=>{const t=B();return T.useMemo(()=>[D.display({id:"select",header:({table:r})=>e.jsx(A,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:a=>r.toggleAllPageRowsSelected(!!a)}),cell:({row:r})=>e.jsx(A,{checked:r.getIsSelected(),onCheckedChange:a=>r.toggleSelected(!!a),onClick:a=>{a.stopPropagation()}})}),...t,D.display({id:"actions",cell:({row:r})=>e.jsx(ue,{group:r.original,customerId:s})})],[t])},b="cusord",C=10,ge="*customer,*items,*sales_channel",xe="id,status,display_id,created_at,email,fulfillment_status,payment_status,total,currency_code",fe=({customer:s})=>{const{t}=S(),{searchParams:r,raw:a}=Q({pageSize:C,prefix:b}),{orders:l,count:c,isLoading:o,isError:d,error:p}=re({customer_id:s.id,fields:xe+","+ge,...r},{placeholderData:G}),g=he(),x=H(),{table:h}=N({data:l??[],columns:g,enablePagination:!0,count:c,pageSize:C,prefix:b});if(d)throw p;return e.jsxs(_,{className:"divide-y p-0",children:[e.jsx("div",{className:"flex items-center justify-between px-6 py-4",children:e.jsx(w,{level:"h2",children:t("orders.domain")})}),e.jsx(z,{columns:g,table:h,pagination:!0,navigateTo:y=>`/orders/${y.original.id}`,filters:x,count:c,isLoading:o,pageSize:C,orderBy:[{key:"display_id",label:t("orders.fields.displayId")},{key:"created_at",label:t("fields.createdAt")},{key:"updated_at",label:t("fields.updatedAt")}],search:!0,queryObject:a,prefix:b})]})},he=()=>{const s=$({exclude:["customer"]});return T.useMemo(()=>[...s],[s])},os=()=>{const{id:s}=K(),t=U(),{customer:r,isLoading:a,isError:l,error:c}=X(s,void 0,{initialData:t}),{getWidgets:o}=J();if(a||!r)return e.jsx(W,{sections:2,showJSON:!0,showMetadata:!0});if(l)throw c;return e.jsxs(ne,{widgets:{before:o("customer.details.before"),after:o("customer.details.after")},data:r,hasOutlet:!0,showJSON:!0,showMetadata:!0,children:[e.jsx(de,{customer:r}),e.jsx(fe,{customer:r}),e.jsx(me,{customer:r})]})},ye=s=>({queryKey:ae.detail(s),queryFn:async()=>oe.admin.customer.retrieve(s)}),is=async({params:s})=>{const t=s.id,r=ye(t);return E.getQueryData(r.queryKey)??await E.fetchQuery(r)};export{os as Component,is as loader};
